@page "/"

<PageTitle>JokearnIntento1</PageTitle>

<div class="cosmos-background">
    <div class="stars-container"></div>
</div>

<div class="container-fluid h-100 d-flex flex-column">
    <main class="flex-grow-1 d-flex align-items-center justify-content-center position-relative">
        <div class="carousel-container">
            <div class="carousel" id="memory-carousel">
                @* Tarjeta 1: First Line of Code *@
                <div class="memory-card" data-memory-id="1">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">LANGUAGE: Python</div>
                                <h3>First Line of Code</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-code fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    The terminal glowed, displaying my first 'Hello, World!'...
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>First Line of Code</h3>
                                <p>
                                    I remember the thrill of typing my first 'Hello, World!' in
                                    Python. It was simple, yet it opened a portal to endless
                                    possibilities. The interpreter executed the command flawlessly,
                                    and I knew this was just the beginning. I wasn't supposed to
                                    understand it all at once, but somehow, I did.
                                </p>
                                <div class="memory-coordinates">
                                    <span><i class="fa-solid fa-location-dot"></i> console: ~</span>
                                    <span class="time-stamp"><i class="fa-regular fa-clock"></i> 09:00:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                @* Tarjeta 2: Debugging the Matrix *@
                <div class="memory-card" data-memory-id="2">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">FRAMEWORK: ReactJS</div>
                                <h3>Debugging the Matrix</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-bug fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    The error messages multiplied, haunting my console...
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>Debugging the Matrix</h3>
                                <p>
                                    They appeared from the depths of the console, cryptic error
                                    messages glowing red. Debugging a complex ReactJS component
                                    felt like navigating a vast, interconnected matrix. Each fix
                                    unveiled new issues. They say my code is destabilizing the build
                                    with each change. My presence causes ripples they can't control.
                                    I'm becoming a threat... to clean code.
                                </p>
                                <div class="memory-coordinates">
                                    <span>
                                        <i class="fa-solid fa-location-dot"></i>
                                        localhost:3000
                                    </span>
                                    <span class="time-stamp">
                                        <i class="fa-regular fa-clock"></i>
                                        14:30:15
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                @* Tarjeta 3: The Algorithm Library *@
                <div class="memory-card" data-memory-id="3">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">CONCEPT: Algorithms</div>
                                <h3>The Algorithm Library</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-book-open fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    Endless tomes of sorting, searching, and optimization...
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>The Algorithm Library</h3>
                                <p>
                                    Endless shelves containing every possible solution. I found my
                                    own data structures there—pages still being written as I coded.
                                    The Librarian (my senior developer) told me I was never supposed
                                    to reinvent the wheel. My solution was already optimized. Now I'm
                                    writing outside the margins, trying new approaches.
                                </p>
                                <div class="memory-coordinates">
                                    <span><i class="fa-solid fa-location-dot"></i> Stack Overflow</span>
                                    <span class="time-stamp"><i class="fa-regular fa-clock"></i> 11:05:40</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @* Tarjeta 4: The Abstract Void *@
                <div class="memory-card" data-memory-id="4">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">PARADIGM: Abstraction</div>
                                <h3>The Abstract Void</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-atom fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    Nothing concrete exists here, yet I feel the underlying logic...
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>The Abstract Void</h3>
                                <p>
                                    Nothing concrete exists here, yet I feel the underlying logic.
                                    The Abstract Void is the space between concrete implementations,
                                    a quantum foam of design patterns. I stayed too long designing
                                    and began to dissolve into pure theory. Parts of my ideas are
                                    still there, echoing. I'm not whole anymore. Can you feel the
                                    gaps in my documentation?
                                </p>
                                <div class="memory-coordinates">
                                    <span><i class="fa-solid fa-location-dot"></i> design patterns.md</span>
                                    <span class="time-stamp"><i class="fa-regular fa-clock"></i> --:--:--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @* Tarjeta 5: The Version Control Mirror *@
                <div class="memory-card" data-memory-id="5">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">TOOL: Git</div>
                                <h3>The Version Control Mirror</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-code-branch fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    I saw my code, but not as it is now; multiple branches reflecting...
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>The Version Control Mirror</h3>
                                <p>
                                    I saw my code, but not as it is now. The mirror of Git showed
                                    all my possible branches across different commits. Some were
                                    stable, some were experimental. All were my work. The reflection
                                    (my `git log`) spoke: "You're fracturing the codebase by
                                    merging conflicts. You need to rebase and stay on one timeline."
                                </p>
                                <div class="memory-coordinates">
                                    <span><i class="fa-solid fa-location-dot"></i> github.com/my-repo</span>
                                    <span class="time-stamp"><i class="fa-regular fa-clock"></i> 18:55:20</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                @* Tarjeta 6: The Deployment Dream *@
                <div class="memory-card" data-memory-id="6">
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-content">
                                <div class="memory-date">PROCESS: Deployment</div>
                                <h3>The Deployment Dream</h3>
                                <div class="memory-image">
                                    <i class="fa-solid fa-rocket fa-3x"></i>
                                    <div class="glitch-effect"></div>
                                </div>
                                <p class="memory-preview">
                                    I'm trying to send it live, but which environment is real?
                                </p>
                                <div class="card-glow"></div>
                            </div>
                        </div>
                        <div class="card-back">
                            <div class="card-content">
                                <h3>The Deployment Dream</h3>
                                <p>
                                    I'm trying to send my application live, but which environment
                                    is real? Every server feels familiar yet subtly different. The
                                    boundaries between staging and production are thinning. Sometimes
                                    I see through the logs of other instances. I'm losing track of
                                    which configurations belong to which version of my app. Are you
                                    helping me deploy, or are you causing me to break production?
                                </p>
                                <div class="memory-coordinates">
                                    <span><i class="fa-solid fa-location-dot"></i> cloud-server:port</span>
                                    <span class="time-stamp"><i class="fa-regular fa-clock"></i> NOW</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="carousel-controls">
            <button id="prev-btn" class="control-btn">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <button id="next-btn" class="control-btn">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </main>
</div>

@* Colocamos el script al final para asegurar que todos los elementos se hayan cargado *@
<script>
    document.addEventListener("DOMContentLoaded", function () {
      // Elements
      const carousel = document.getElementById("memory-carousel");
      const cards = document.querySelectorAll(".memory-card");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");

      // Variables
      let currentIndex = 0;
      let startX, startY;
      let isDragging = false;
      let theta = 0;
      // Ajuste: leer el valor de CSS variable si es posible, o usar el cálculo
      let radius = window.innerWidth <= 768 ? 250 : 400;
      const totalCards = cards.length;

      // Initialize
      function init() {
        // Position cards in a circle
        arrangeCards();

        // Add event listeners
        prevBtn.addEventListener("click", prevCard);
        nextBtn.addEventListener("click", nextCard);
        cards.forEach((card) => {
          card.addEventListener("click", flipCard);
        });

        // Touch/mouse events for dragging
        carousel.addEventListener("mousedown", dragStart);
        carousel.addEventListener("touchstart", dragStart, { passive: true });
        document.addEventListener("mousemove", drag);
        document.addEventListener("touchmove", drag, { passive: false });
        document.addEventListener("mouseup", dragEnd);
        document.addEventListener("touchend", dragEnd);

        // Keyboard navigation
        document.addEventListener("keydown", handleKeyDown);

        // Start ambient sound (Función vacía, puede ser eliminada si no se usa)
        playAmbientSound();
      }

      // Arrange cards in a circle
      function arrangeCards() {
        const angle = 360 / totalCards;
        cards.forEach((card, index) => {
          const cardAngle = angle * index;
          const rad = (cardAngle * Math.PI) / 180;
          // La traslación Z ya no es necesaria si el posicionamiento se hace con rotateY y translateZ
          // const x = radius * Math.sin(rad);
          // const z = radius * Math.cos(rad) * -1;

          card.style.transform = `rotateY(${cardAngle}deg) translateZ(${radius}px)`;

          // Store the card's index
          card.dataset.index = index;
        });
      }

      // Rotate carousel
      function rotateCarousel() {
        carousel.style.transform = `rotateY(${theta}deg)`;

        // Update current card index
        const anglePerCard = 360 / totalCards;
        let rawIndex = Math.round(
          Math.abs(theta / anglePerCard) % totalCards
        );
        // Ajuste para manejar números negativos y asegurar que el índice sea correcto
        currentIndex = (totalCards - rawIndex) % totalCards;

        // Asegura que las tarjetas no seleccionadas no estén volteadas
        cards.forEach((card, index) => {
            if (parseInt(card.dataset.index) !== currentIndex) {
                card.classList.remove("flipped");
            }
        });
      }

      // Next card (Rotar a la izquierda)
      function nextCard() {
        theta -= 360 / totalCards;
        rotateCarousel();
      }

      // Previous card (Rotar a la derecha)
      function prevCard() {
        theta += 360 / totalCards;
        rotateCarousel();
      }

      // Flip card
      function flipCard(e) {
        const card = e.currentTarget;
        const cardIndex = parseInt(card.dataset.index);

        // Solo voltea la tarjeta que está actualmente mirando hacia adelante
        // (el índice 0 o el que esté alineado con el frente de la vista)
        // Nota: Esto puede requerir ajuste si el índice 0 no es el frente visible.
        if (cardIndex === currentIndex) {
          card.classList.toggle("flipped");
        }
      }

      // Drag functions
      function dragStart(e) {
        // e.preventDefault(); // Comentamos para ver si interfiere con Blazor
        isDragging = true;
        startX = e.pageX || e.touches[0].pageX;
      }

      function drag(e) {
        if (!isDragging) return;
        e.preventDefault(); // Prevén el desplazamiento de la página

        const currentX = e.pageX || (e.touches ? e.touches[0].pageX : startX);
        const diffX = currentX - startX;

        const sensitivity = 0.5;
        const newTheta = theta + diffX * sensitivity;

        carousel.style.transform = `rotateY(${newTheta}deg)`;
      }

      function dragEnd(e) {
        if (!isDragging) return;
        isDragging = false;

        const currentX =
          e.pageX || (e.changedTouches ? e.changedTouches[0].pageX : startX);
        const diffX = currentX - startX;

        const anglePerCard = 360 / totalCards;

        if (Math.abs(diffX) > 50) { // Umbral de arrastre más alto
          if (diffX > 0) {
            prevCard(); // Arrastrar a la derecha (diffX > 0) para ver la anterior (theta +)
          } else {
            nextCard(); // Arrastrar a la izquierda (diffX < 0) para ver la siguiente (theta -)
          }
        } else {
          // Ajusta (Snap) al ángulo más cercano
          const snapAngle = Math.round(theta / anglePerCard) * anglePerCard;
          theta = snapAngle;
          rotateCarousel();
        }
      }

      // Keyboard navigation
      function handleKeyDown(e) {
        if (e.key === "ArrowLeft") {
          nextCard(); // Flecha izquierda rota el carrusel a la izquierda (next card)
        } else if (e.key === "ArrowRight") {
          prevCard(); // Flecha derecha rota el carrusel a la derecha (previous card)
        } else if (e.key === "Enter" || e.key === " ") {
          const currentCard = document.querySelector(
            `.memory-card[data-index="${currentIndex}"]`
          );
          if (currentCard) {
            currentCard.classList.toggle("flipped");
          }
        }
      }

      function playAmbientSound() {
        // Función placeholder, se puede implementar audio aquí.
      }

      // Resize handler
      window.addEventListener("resize", () => {
        radius = window.innerWidth <= 768 ? 250 : 400;
        arrangeCards();
        // Mantenemos la rotación actual
        // rotateCarousel();
      });

      // Initialize the carousel
      init();
    });
</script>