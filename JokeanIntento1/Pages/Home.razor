@page "/"

@inject HttpClient Http


<PageTitle>Servicios Disponibles</PageTitle>

<div class="cosmos-background">
    <div class="stars-container"></div>
</div>

<div class="container-fluid h-100 d-flex flex-column">
    <main class="flex-grow-1 d-flex align-items-center justify-content-center position-relative">
        <div class="carousel-container">
            <div class="carousel" id="memory-carousel">

                @foreach (var s in servicios)
                {
                    <div class="memory-card">
                        <div class="card-inner">

                            <!-- FRONT -->
                            <div class="card-front">
                                <div class="card-content">
                                    <div class="memory-date">
                                        @s.TipoTransporte
                                    </div>

                                    <h3>@s.NombreConductor</h3>


                                    <p class="memory-preview">
                                        @s.Descripcion
                                    </p>

                                    <img src="@GetImagenPorTipo(s.TipoTransporte)" class="card-img-top memory-img" />

                                    <p class="memory-preview">
                                        <strong>Valor:</strong> $@s.Valor <br />
                                        <strong>Estado:</strong> @s.Estado
                                    </p>

                                   <button class="submit-btn fs-6" @onclick="() => IrAReserva(s)">
    Reservar
</button>

                                </div>
                            </div>

                            <!-- BACK -->
                            <div class="card-back">
                                <div class="card-content">

                                    <h3>Detalles del servicio</h3>

                                    <p><strong>Conductor:</strong> @s.NombreConductor</p>
                                    <p><strong>Vehículo:</strong> @s.Vehiculo</p>
                                    <p><strong>Teléfono:</strong> @s.TelefonoConductor</p

                                    <p><strong>Descripción:</strong><br /> @s.Descripcion</p>

                                </div>
                            </div>

                        </div>
                    </div>
                }

            </div>

        </div>

        <div class="carousel-controls opacity-25">
            <button id="prev-btn" class="control-btn">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <button id="next-btn" class="control-btn">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
    </main>
</div>

@code {

    [Inject] private IJSRuntime JS { get; set; } protected override async Task OnAfterRenderAsync(bool firstRender) { if (firstRender) { await JS.InvokeVoidAsync("initCarousel"); } }

    List<ServicioDTO> servicios = new();

    bool modalAbierto = false;
    ServicioDTO? servicioSeleccionado;

    string? formFecha;
    string? formNotas;

    protected override async Task OnInitializedAsync()
    {
        // Cuando tengas API, SOLO activas esta línea:
        // servicios = await Http.GetFromJsonAsync<List<ServicioDTO>>("api/servicios");

        // Datos de ejemplo mientras la API no está conectada
        servicios = new List<ServicioDTO>
        {
            new ServicioDTO {
                TipoTransporte = "Camión sencillo",
                NombreConductor = "Carlos López",
                Vehiculo = "Chevrolet NHR",
                TelefonoConductor = "3001234567",
                DireccionOrigen = "Calle 10 #5-11",
                DireccionDestino = "Av 80 # 45-90",
                Descripcion = "Transporte de carga liviana",
                Valor = 180000,
                Estado = "Disponible"
            },
            new ServicioDTO {
                TipoTransporte = "Furgón",
                NombreConductor = "Juan Martínez",
                Vehiculo = "Furgón Hyundai",
                TelefonoConductor = "3019988776",
                DireccionOrigen = "Cra 30 # 20-10",
                DireccionDestino = "Itagüí",
                Descripcion = "Transporte refrigerado",
                Valor = 250000,
                Estado = "Disponible"
            }
        };
    }

    // Clase que representa un servicio (DEBE COINCIDIR CON TU BASE DE DATOS)
    public class ServicioDTO
    {
        public string? ImagenUrl { get; set; }

        public string? TipoTransporte { get; set; }
        public string? NombreConductor { get; set; }
        public string? Vehiculo { get; set; }
        public string? TelefonoConductor { get; set; }
        public string? DireccionOrigen { get; set; }
        public string? DireccionDestino { get; set; }
        public string? Descripcion { get; set; }
        public decimal Valor { get; set; }
        public string? Estado { get; set; }
    }

    string GetImagenPorTipo(string? tipo)
    {
        if (string.IsNullOrWhiteSpace(tipo))
            return "https://images.unsplash.com/photo-1502877338535-766e1452684a";

        tipo = tipo.ToLower();

        if (tipo.Contains("Chiva"))
            return "https://chivasrumba.com.co/wp-content/uploads/2024/03/chiva-rumbera-1-1020x1024.jpg";

        if (tipo.Contains("Moto"))
            return "https://thumbs.dreamstime.com/b/motocicleta-futurista-bajo-un-brillante-cielo-ne%C3%B3n-en-ocaso-una-elegante-con-brillantes-llantas-azules-descansa-paisaje-al-aire-384338010.jpg";

        if (tipo.Contains("Bicitaxi"))
            return "https://static.vecteezy.com/system/resources/previews/026/991/586/non_2x/rickshaw-of-a-beautiful-transportation-with-futuristic-design-ai-generated-photo.jpg";

        if (tipo.Contains("Jeep"))
        return "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR3UiiLZWYQjSdP76COzXOIxh_5jHPG1-BlHw&s";
        if (tipo.Contains("Lancha"))
        return "https://restagenciaturistica.com/wp-content/uploads/2019/05/CENA-SIBARITA.-PABLO.jpg";


        return "https://images.unsplash.com/photo-1502877338535-766e1452684a"; // por defecto
    }

    [Inject] NavigationManager Nav { get; set; }

    void IrAReserva(ServicioDTO s)
    {

        int id = servicios.IndexOf(s);

        Nav.NavigateTo($"/reservar/{id}");
    }
}
